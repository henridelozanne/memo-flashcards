const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./-X4PZx9X.js","./BzQlD_xP.js","./entry.Bc7Sv5ip.css"])))=>i.map(i=>d[i]);
import{r as j,S as R,Z as K}from"./BzQlD_xP.js";const f=[];for(let t=0;t<256;++t)f.push((t+256).toString(16).slice(1));function X(t,e=0){return(f[t[e+0]]+f[t[e+1]]+f[t[e+2]]+f[t[e+3]]+"-"+f[t[e+4]]+f[t[e+5]]+"-"+f[t[e+6]]+f[t[e+7]]+"-"+f[t[e+8]]+f[t[e+9]]+"-"+f[t[e+10]]+f[t[e+11]]+f[t[e+12]]+f[t[e+13]]+f[t[e+14]]+f[t[e+15]]).toLowerCase()}let k;const z=new Uint8Array(16);function Y(){if(!k){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");k=crypto.getRandomValues.bind(crypto)}return k(z)}const Z=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:Z};function Q(t,e,n){var i;if(W.randomUUID&&!t)return W.randomUUID();t=t||{};const s=t.random??((i=t.rng)==null?void 0:i.call(t))??Y();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,X(s)}/*! Capacitor: https://capacitorjs.com/ - MIT License */var _;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(_||(_={}));class $ extends Error{constructor(e,n,s){super(e),this.message=e,this.code=n,this.data=s}}const ee=t=>{var e,n;return t!=null&&t.androidBridge?"android":!((n=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},te=t=>{const e=t.CapacitorCustomPlatform||null,n=t.Capacitor||{},s=n.Plugins=n.Plugins||{},i=()=>e!==null?e.name:ee(t),o=()=>i()!=="web",a=d=>{const u=c.get(d);return!!(u!=null&&u.platforms.has(i())||r(d))},r=d=>{var u;return(u=n.PluginHeaders)===null||u===void 0?void 0:u.find(O=>O.name===d)},l=d=>t.console.error(d),c=new Map,w=(d,u={})=>{const O=c.get(d);if(O)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),O.proxy;const C=i(),P=r(d);let b;const V=async()=>(!b&&C in u?b=typeof u[C]=="function"?b=await u[C]():b=u[C]:e!==null&&!b&&"web"in u&&(b=typeof u.web=="function"?b=await u.web():b=u.web),b),q=(m,g)=>{var y,p;if(P){const v=P==null?void 0:P.methods.find(h=>g===h.name);if(v)return v.rtype==="promise"?h=>n.nativePromise(d,g.toString(),h):(h,S)=>n.nativeCallback(d,g.toString(),h,S);if(m)return(y=m[g])===null||y===void 0?void 0:y.bind(m)}else{if(m)return(p=m[g])===null||p===void 0?void 0:p.bind(m);throw new $(`"${d}" plugin is not implemented on ${C}`,_.Unimplemented)}},D=m=>{let g;const y=(...p)=>{const v=V().then(h=>{const S=q(h,m);if(S){const x=S(...p);return g=x==null?void 0:x.remove,x}else throw new $(`"${d}.${m}()" is not implemented on ${C}`,_.Unimplemented)});return m==="addListener"&&(v.remove=async()=>g()),v};return y.toString=()=>`${m.toString()}() { [capacitor code] }`,Object.defineProperty(y,"name",{value:m,writable:!1,configurable:!1}),y},N=D("addListener"),H=D("removeListener"),G=(m,g)=>{const y=N({eventName:m},g),p=async()=>{const h=await y;H({eventName:m,callbackId:h},g)},v=new Promise(h=>y.then(()=>h({remove:p})));return v.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await p()},v},I=new Proxy({},{get(m,g){switch(g){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return P?G:N;case"removeListener":return H;default:return D(g)}}});return s[d]=I,c.set(d,{name:d,proxy:I,platforms:new Set([...Object.keys(u),...P?[C]:[]])}),I};return n.convertFileSrc||(n.convertFileSrc=d=>d),n.getPlatform=i,n.handleError=l,n.isNativePlatform=o,n.isPluginAvailable=a,n.registerPlugin=w,n.Exception=$,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},ne=t=>t.Capacitor=te(t),L=ne(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),B=L.registerPlugin;class J{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,n){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(n);const o=this.windowListeners[e];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(e);const a=async()=>this.removeListener(e,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,n,s){const i=this.listeners[e];if(!i){if(s){let o=this.retainedEventArguments[e];o||(o=[]),o.push(n),this.retainedEventArguments[e]=o}return}i.forEach(o=>o(n))}hasListeners(e){var n;return!!(!((n=this.listeners[e])===null||n===void 0)&&n.length)}registerWindowListener(e,n){this.windowListeners[n]={registered:!1,windowEventName:e,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(e="not implemented"){return new L.Exception(e,_.Unimplemented)}unavailable(e="not available"){return new L.Exception(e,_.Unavailable)}async removeListener(e,n){const s=this.listeners[e];if(!s)return;const i=s.indexOf(n);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const n=this.retainedEventArguments[e];n&&(delete this.retainedEventArguments[e],n.forEach(s=>{this.notifyListeners(e,s)}))}}const F=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),M=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class re extends J{async getCookies(){const e=document.cookie,n={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=M(i).trim(),o=M(o).trim(),n[i]=o}),n}async setCookie(e){try{const n=F(e.key),s=F(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,o=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${n}=${s||""}${i}; path=${o}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const n of e)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}B("CapacitorCookies",{web:()=>new re});const se=async t=>new Promise((e,n)=>{const s=new FileReader;s.onload=()=>{const i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>n(i),s.readAsDataURL(t)}),oe=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(i=>i.toLocaleLowerCase()).reduce((i,o,a)=>(i[o]=t[e[a]],i),{})},ae=(t,e=!0)=>t?Object.entries(t).reduce((s,i)=>{const[o,a]=i;let r,l;return Array.isArray(a)?(l="",a.forEach(c=>{r=e?encodeURIComponent(c):c,l+=`${o}=${r}&`}),l.slice(0,-1)):(r=e?encodeURIComponent(a):a,l=`${o}=${r}`),`${s}&${l}`},"").substr(1):null,ie=(t,e={})=>{const n=Object.assign({method:t.method||"GET",headers:t.headers},e),i=oe(t.headers)["content-type"]||"";if(typeof t.data=="string")n.body=t.data;else if(i.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[a,r]of Object.entries(t.data||{}))o.set(a,r);n.body=o.toString()}else if(i.includes("multipart/form-data")||t.data instanceof FormData){const o=new FormData;if(t.data instanceof FormData)t.data.forEach((r,l)=>{o.append(l,r)});else for(const r of Object.keys(t.data))o.append(r,t.data[r]);n.body=o;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(i.includes("application/json")||typeof t.data=="object")&&(n.body=JSON.stringify(t.data));return n};class le extends J{async request(e){const n=ie(e,e.webFetchExtra),s=ae(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,o=await fetch(i,n),a=o.headers.get("content-type")||"";let{responseType:r="text"}=o.ok?e:{};a.includes("application/json")&&(r="json");let l,c;switch(r){case"arraybuffer":case"blob":c=await o.blob(),l=await se(c);break;case"json":l=await o.json();break;case"document":case"text":default:l=await o.text()}const w={};return o.headers.forEach((d,u)=>{w[u]=d}),{data:l,headers:w,status:o.status,url:o.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}B("CapacitorHttp",{web:()=>new le});const U=j([]),T=j(!0),E=j(null);async function A(){if(!L.isNativePlatform())throw new Error("Database only available on native platform");const{default:t}=await K(async()=>{const{default:n}=await import("./-X4PZx9X.js");return{default:n}},__vite__mapDeps([0,1,2]),import.meta.url),e=await t("memoflash");return await e.exec(`
    CREATE TABLE IF NOT EXISTS collections (
      id TEXT PRIMARY KEY,
      user_id TEXT NOT NULL DEFAULT 'default-user',
      name TEXT NOT NULL,
      created_at INTEGER NOT NULL,
      updated_at INTEGER NOT NULL,
      deleted_at INTEGER
    )
  `),e}const de=()=>{const t=async()=>{T.value=!0,E.value=null;try{if(L.isNativePlatform()){const r=await(await A()).all("SELECT * FROM collections WHERE deleted_at IS NULL ORDER BY updated_at DESC");U.value=r}else{const a=localStorage.getItem("memo_collections");U.value=a?JSON.parse(a):[]}}catch(a){E.value=a.message||"Erreur lors du chargement des collections"}finally{T.value=!1}},e=a=>U.value.find(r=>r.id===a&&!r.deleted_at)??null,n=async a=>{E.value=null;try{const r={id:Q(),user_id:"default-user",name:a.trim(),created_at:Date.now(),updated_at:Date.now()};if(L.isNativePlatform()){const l=await A(),c=await l.get("SELECT COUNT(*) as count FROM collections WHERE name = ? AND deleted_at IS NULL",[a.trim()]);if(c&&c.count>0)throw new Error(`Collection "${a}" already exists`);await l.run("INSERT INTO collections (id, user_id, name, created_at, updated_at) VALUES (?, ?, ?, ?, ?)",[r.id,r.user_id,r.name,r.created_at,r.updated_at])}else{const l=localStorage.getItem("memo_collections"),c=l?JSON.parse(l):[];if(c.some(w=>w.name.toLowerCase()===a.trim().toLowerCase()&&!w.deleted_at))throw new Error(`Collection "${a}" already exists`);c.unshift(r),localStorage.setItem("memo_collections",JSON.stringify(c))}return await t(),r}catch(r){throw E.value=r.message||"Erreur lors de la création",r}},s=async(a,r)=>{E.value=null;try{if(L.isNativePlatform()){const l=await A(),c=await l.get("SELECT COUNT(*) as count FROM collections WHERE name = ? AND id != ? AND deleted_at IS NULL",[r.trim(),a]);if(c&&c.count>0)throw new Error(`Collection "${r}" already exists`);await l.run("UPDATE collections SET name = ?, updated_at = ? WHERE id = ? AND deleted_at IS NULL",[r.trim(),Date.now(),a])}else{const l=localStorage.getItem("memo_collections"),c=l?JSON.parse(l):[],w=c.findIndex(d=>d.id===a&&!d.deleted_at);if(w===-1)throw new Error("Collection not found");if(c.some(d=>d.name.toLowerCase()===r.trim().toLowerCase()&&d.id!==a&&!d.deleted_at))throw new Error(`Collection "${r}" already exists`);c[w].name=r.trim(),c[w].updated_at=Date.now(),localStorage.setItem("memo_collections",JSON.stringify(c))}await t()}catch(l){throw E.value=l.message||"Erreur lors de la mise à jour",l}},i=async a=>{E.value=null;try{if(L.isNativePlatform())await(await A()).run("UPDATE collections SET deleted_at = ? WHERE id = ? AND deleted_at IS NULL",[Date.now(),a]);else{const r=localStorage.getItem("memo_collections"),l=r?JSON.parse(r):[],c=l.findIndex(w=>w.id===a&&!w.deleted_at);if(c===-1)throw new Error("Collection not found");l[c].deleted_at=Date.now(),localStorage.setItem("memo_collections",JSON.stringify(l))}await t()}catch(r){throw E.value=r.message||"Erreur lors de la suppression",r}},o=()=>{U.value=[],E.value=null,T.value=!1};return{collections:R(U),isLoading:R(T),error:R(E),loadCollections:t,getCollection:e,createCollection:n,updateCollection:s,deleteCollection:i,resetCollections:o}};export{L as C,J as W,B as r,de as u,Q as v};
