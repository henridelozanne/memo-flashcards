import{_ as A}from"./CKD7xOmG.js";import{_ as L}from"./BebTYC0G.js";import{d as q,U as F,V as H,r as d,o as K,x as n,z as t,N as O,K as h,A as a,O as f,D as p,B as P,R as U,C as G,M as J,y as l}from"./BzQlD_xP.js";import{u as Q}from"./AebXkaNM.js";import{u as W}from"./CkUdmUOO.js";const X={class:"min-h-screen bg-gray-50 p-6"},Y={class:"max-w-md mx-auto"},Z={class:"flex items-center mb-6"},ee={class:"text-2xl font-bold","data-testid":"heading-edit-card"},te={key:0,class:"flex justify-center items-center py-12","data-testid":"loading"},se={class:"ml-2 text-gray-600"},oe={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},ae={key:2,class:"text-center text-gray-600"},le={key:3},ne={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"},re={class:"text-sm text-blue-700"},de={class:"font-medium"},ie={class:"bg-white rounded-lg shadow p-6 mb-6","data-testid":"edit-card-form"},ue={class:"bg-white rounded-lg shadow p-6"},ge=q({name:"EditCardPage",__name:"edit",setup(ce){const k=H(),b=J(),{t:i}=F(),{collections:$,loadCollections:M,getCollection:B}=Q(),{cards:S,isLoading:D,error:x,loadCards:E,getCard:V,updateCard:N,deleteCard:j}=W(),u=String(k.params.id),g=String(k.params.cardId),c=d(null),m=d(null),y=d(!1),C=d(!1),r=d(!1),o=d(null);async function _(){o.value=null,$.value.length||await M(),c.value=B(u),c.value&&(S.value.length||await E(u),m.value=V(g))}async function I(s,e){y.value=!0,o.value=null;try{await N(g,s,e),o.value={type:"success",text:i("cards.updatedSuccess")},setTimeout(()=>{b.push(`/collections/${u}/cards`)},1500)}catch(v){o.value={type:"error",text:v instanceof Error?v.message:i("cards.updatedError")}}finally{y.value=!1}}function R(){r.value=!0}async function T(){C.value=!0;try{await j(g),o.value={type:"success",text:i("cards.deletedSuccess")},r.value=!1,setTimeout(()=>{b.push(`/collections/${u}/cards`)},1e3)}catch(s){o.value={type:"error",text:s instanceof Error?s.message:i("cards.deletedError")},r.value=!1}finally{C.value=!1}}return K(_),(s,e)=>{const v=A,z=L;return l(),n("div",X,[t("div",Y,[t("div",Z,[t("button",{class:"mr-4 text-gray-600 hover:text-gray-800","aria-label":"Retour",onClick:e[0]||(e[0]=w=>s.$router.back())},[...e[3]||(e[3]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("h1",ee,a(s.$t("cards.editTitle")),1)]),f(D)?(l(),n("div",te,[e[4]||(e[4]=t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)),t("span",se,a(s.$t("common.loading")),1)])):f(x)?(l(),n("div",oe,[p(a(f(x))+" ",1),t("button",{class:"ml-2 underline",onClick:_},a(s.$t("common.retry")),1)])):m.value?(l(),n("div",le,[c.value?(l(),n("div",ne,[t("p",re,[t("span",de,a(s.$t("collections.collection"))+":",1),p(" "+a(c.value.name),1)])])):h("",!0),t("div",ie,[P(v,{front:m.value.question,back:m.value.answer,"is-submitting":y.value,"submit-label":s.$t("common.save"),onSubmit:I,onCancel:e[1]||(e[1]=w=>f(b).back())},null,8,["front","back","is-submitting","submit-label"])]),t("div",ue,[t("button",{class:"w-full px-4 py-2 text-red-700 bg-red-100 rounded-md hover:bg-red-200 transition flex items-center justify-center gap-2","data-testid":"delete-card-btn",onClick:R},[e[5]||(e[5]=t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),p(" "+a(s.$t("cards.deleteConfirm")),1)])]),o.value?(l(),n("div",{key:1,class:U(["mt-4 p-4 rounded-md",o.value.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},a(o.value.text),3)):h("",!0)])):(l(),n("div",ae," Carte introuvable "))]),r.value?(l(),O(z,{key:0,open:r.value,title:s.$t("cards.deleteConfirm"),"confirm-label":s.$t("common.delete"),loading:C.value,onCancel:e[2]||(e[2]=w=>r.value=!1),onConfirm:T},{default:G(()=>[p(a(s.$t("cards.deleteMessage"))+" ",1),e[6]||(e[6]=t("br",null,null,-1)),e[7]||(e[7]=t("span",{class:"text-sm text-gray-500"},"Cette action est irr√©versible.",-1))]),_:1},8,["open","title","confirm-label","loading"])):h("",!0)])}}});export{ge as default};
