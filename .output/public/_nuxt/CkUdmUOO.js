import{v as D}from"./AebXkaNM.js";import{r as x,S as p}from"./BzQlD_xP.js";let t=[];const c=x([]),f=x(!1),u=x(null),E={1:0,2:1,3:3,4:7,5:14,6:30},L=w=>{const s=Date.now();return[...t].filter(o=>o.collection_id===w&&!o.deleted_at&&o.next_review_at<=s&&(o.compartment??1)<6).sort((o,l)=>o.next_review_at!==l.next_review_at?o.next_review_at-l.next_review_at:o.created_at-l.created_at)},y=()=>[],I=(w,s)=>{const o=t.findIndex(i=>i.id===w.id&&!i.deleted_at);if(o===-1)throw new Error("Carte introuvable");let l=t[o].compartment??1;s==="false"?l=1:(s==="almost"||s==="true")&&(l=Math.min(l+1,6)),t[o].compartment=l;const m=Date.now(),v=E[l]??0;t[o].next_review_at=m+v*24*60*60*1e3,t[o].updated_at=m;const C=t[o].collection_id;c.value=[...t].filter(i=>i.collection_id===C&&!i.deleted_at).sort((i,g)=>g.created_at-i.created_at)},q=()=>{const w=async n=>{f.value=!0,u.value=null,await new Promise(e=>setTimeout(e,100)),c.value=[...t].filter(e=>e.collection_id===n&&!e.deleted_at).sort((e,a)=>a.created_at-e.created_at),f.value=!1},s=n=>c.value.find(e=>e.id===n&&!e.deleted_at)??null,o=async(n,e,a)=>{if(u.value=null,!n.trim())throw new Error("Le recto de la carte est obligatoire");if(!e.trim())throw new Error("Le verso de la carte est obligatoire");const r=Date.now(),_={id:D(),question:n.trim(),answer:e.trim(),collection_id:a,user_id:"mock-user",created_at:r,updated_at:r,compartment:1,next_review_at:r,archived:!1};return t.unshift(_),c.value=[...t].filter(d=>d.collection_id===a&&!d.deleted_at).sort((d,h)=>h.created_at-d.created_at),_},l=async(n,e,a)=>{if(u.value=null,!e.trim())throw new Error("Le recto de la carte est obligatoire");if(!a.trim())throw new Error("Le verso de la carte est obligatoire");const r=t.findIndex(d=>d.id===n&&!d.deleted_at);if(r===-1)throw new Error("Carte introuvable");t[r].question=e.trim(),t[r].answer=a.trim(),t[r].updated_at=Date.now();const _=t[r].collection_id;c.value=[...t].filter(d=>d.collection_id===_&&!d.deleted_at).sort((d,h)=>h.created_at-d.created_at)},m=async n=>{u.value=null;const e=t.findIndex(r=>r.id===n&&!r.deleted_at);if(e===-1)throw new Error("Carte introuvable");t[e].deleted_at=Date.now();const a=t[e].collection_id;c.value=[...t].filter(r=>r.collection_id===a&&!r.deleted_at).sort((r,_)=>_.created_at-r.created_at)},v=n=>t.filter(e=>e.collection_id===n&&!e.deleted_at).length,C=n=>{const e=t.filter(a=>a.collection_id===n&&!a.deleted_at).sort((a,r)=>r.created_at-a.created_at);return e.length>0?new Date(e[0].created_at):null},i=()=>{t=[],c.value=[],u.value=null,f.value=!1},g=(n,e)=>t.filter(a=>a.collection_id===n&&!a.deleted_at&&(a.compartment??1)===e).length;return{cards:p(c),isLoading:p(f),error:p(u),loadCards:w,getCard:s,createCard:o,updateCard:l,deleteCard:m,getCardsCount:v,getLastCardDate:C,resetCards:i,getDueCards:L,getCardsDueToday:y,applyAnswer:I,countCardsPerCompartment:g}};export{q as u};
